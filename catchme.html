<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¥å¥‡å®è´ï¼š25ç§å¤§å‘ç°</title>
    <style>
        body { font-family: 'PingFang SC', sans-serif; background: #eef2f3; text-align: center; margin: 0; overflow: hidden; touch-action: manipulation; }
        #game-container { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; background: white; }
        .screen { display: none; width: 100%; flex-grow: 1; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }
        .trainer-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #ffcc00; background: #fff; object-fit: cover; margin: 10px; cursor: pointer;}
        .bar-container { width: 70%; height: 20px; background: #eee; border-radius: 10px; overflow: hidden; margin: 15px 0; border: 2px solid #444; }
        #energy-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #ff9f43, #ff6b6b); transition: width 0.1s; }
        #toss-bar { width: 80%; height: 24px; background: #ddd; position: relative; border: 2px solid #555; margin: 20px 0; border-radius: 5px; }
        #toss-cursor { width: 14px; height: 100%; background: #222; position: absolute; left: 0; z-index: 5; }
        #target-zone { height: 100%; background: rgba(46, 204, 113, 0.5); position: absolute; }
        .circle-btn { width: 85px; height: 85px; border-radius: 50%; border: none; background: #ff4757; color: white; font-size: 18px; font-weight: bold; box-shadow: 0 6px #ff6b81; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .circle-btn:active { transform: translateY(3px); box-shadow: 0 2px #ff6b81; }
        #collection-shelf { width: 100%; height: 100px; background: #2f3542; display: flex; align-items: center; justify-content: center; gap: 10px; border-top: 4px solid #ffa502; }
        .slot { width: 55px; height: 55px; background: #57606f; border-radius: 10px; border: 2px solid #747d8c; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #aaa; overflow: hidden; }
        .slot img { width: 50px; height: 50px; object-fit: contain; }
        .slot.missed { color: #ff6b6b; font-weight: bold; border-color: #ff4757; }
        .pokemon-img { width: 160px; height: 160px; object-fit: contain; }
        .status-header { position: absolute; top: 10px; right: 10px; font-weight: bold; color: #555; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar" class="status-header">ä»»åŠ¡è¿›åº¦: <span id="attempt-count">0</span>/5</div>

    <div id="screen-select" class="screen active">
        <h2>è¯·é€‰æ‹©ä½ çš„è®­ç»ƒå¸ˆ</h2>
        <div id="trainer-pannel" style="display: flex; justify-content: center;"></div>
    </div>

    <div id="screen-adventure" class="screen">
        <p id="story-display" style="font-weight:bold;"></p>
        <div id="hp-indicator" style="color: #ff4757;">å¯»æ‰¾ä¸­...</div>
        <div class="bar-container"><div id="energy-fill"></div></div>
        <div style="display: flex; gap: 40px;">
            <button class="circle-btn" onclick="addEnergy()">ç‚¹å‡»</button>
            <button class="circle-btn" onclick="addEnergy()">ç‚¹å‡»</button>
        </div>
    </div>

    <div id="screen-catch" class="screen">
        <h3 id="toss-title">å‡†å¤‡æŠ•æ·ï¼</h3>
        <img id="wild-pokemon" class="pokemon-img" src="">
        <p id="pokemon-info" style="font-weight: bold;"></p>
        <div id="toss-bar">
            <div id="target-zone"></div>
            <div id="toss-cursor"></div>
        </div>
        <button class="circle-btn" style="background:#ffa502; box-shadow: 0 6px #e67e22;" onclick="lockToss()">é”å®š</button>
    </div>

    <div id="screen-win" class="screen">
        <h1 style="color: #ffa502;">å¤§å†’é™©ç»“æŸï¼</h1>
        <p id="final-score"></p>
        <button class="circle-btn" style="width:140px; border-radius:15px;" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
    </div>

    <div id="collection-shelf">
        <div class="slot" id="slot-0">1</div>
        <div class="slot" id="slot-1">2</div>
        <div class="slot" id="slot-2">3</div>
        <div class="slot" id="slot-3">4</div>
        <div class="slot" id="slot-4">5</div>
    </div>
</div>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if (type === 'click') { osc.frequency.setValueAtTime(400, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); osc.start(); osc.stop(now + 0.1); }
        else if (type === 'success') { [523, 659, 783].forEach((f, i) => osc.frequency.setValueAtTime(f, now + i * 0.1)); gain.gain.setValueAtTime(0.1, now); osc.start(); osc.stop(now + 0.4); }
        else if (type === 'fail') { osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(50, now + 0.3); gain.gain.setValueAtTime(0.1, now); osc.start(); osc.stop(now + 0.3); }
    }

    let attemptCount = 0, successCount = 0;
    let energy = 0, decayTimer, tossInterval, currentPokemon, tossStep, errors;
    let cursorPos = 0, cursorDir = 1, pokemonsForToday = [];

    // ç²¾çµæ± åº“ (25ä¸ª)
    const pokemonsPool = [
        { name: "çš®å¡ä¸˜", img: "025", difficulty: 1.0, acc: 25 },
        { name: "å¦™è›™ç§å­", img: "001", difficulty: 1.0, acc: 25 },
        { name: "å°ç«é¾™", img: "004", difficulty: 1.0, acc: 25 },
        { name: "æ°å°¼é¾Ÿ", img: "007", difficulty: 1.0, acc: 25 },
        { name: "å·´å¤§è¶", img: "012", difficulty: 0.9, acc: 30 },
        { name: "æ¯”æ¯”é¸Ÿ", img: "017", difficulty: 1.1, acc: 25 },
        { name: "ä¹å°¾", img: "038", difficulty: 1.8, acc: 20 },
        { name: "èƒ–ä¸", img: "039", difficulty: 0.8, acc: 30 },
        { name: "å¯è¾¾é¸­", img: "054", difficulty: 1.2, acc: 25 },
        { name: "é£é€Ÿç‹—", img: "059", difficulty: 2.2, acc: 18 },
        { name: "è€¿é¬¼", img: "094", difficulty: 2.0, acc: 15 },
        { name: "æš´é²¤é¾™", img: "130", difficulty: 2.5, acc: 15 },
        { name: "ä¼Šå¸ƒ", img: "133", difficulty: 1.3, acc: 25 },
        { name: "å¡æ¯”å…½", img: "143", difficulty: 2.8, acc: 18 },
        { name: "æ€¥å†»é¸Ÿ", img: "144", difficulty: 3.5, acc: 12 },
        { name: "é—ªç”µé¸Ÿ", img: "145", difficulty: 3.5, acc: 12 },
        { name: "ç«ç„°é¸Ÿ", img: "146", difficulty: 3.5, acc: 12 },
        { name: "å¿«é¾™", img: "149", difficulty: 3.0, acc: 14 },
        { name: "è¶…æ¢¦", img: "150", difficulty: 4.5, acc: 8 },
        { name: "å‡¤ç‹", img: "250", difficulty: 4.2, acc: 9 },
        { name: "æ´›å¥‡äºš", img: "249", difficulty: 4.2, acc: 9 },
        { name: "æ°´å›", img: "245", difficulty: 3.0, acc: 13 },
        { name: "ç­åŸºæ‹‰æ–¯", img: "248", difficulty: 3.2, acc: 12 },
        { name: "çƒˆç©ºå", img: "384", difficulty: 4.8, acc: 7 },
        { name: "åˆ©æ¬§è·¯", img: "447", difficulty: 1.5, acc: 22 }
    ];

    window.onload = function() {
        const pannel = document.getElementById('trainer-pannel');
        let ids = Array.from({length: 26}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
        ids.slice(0, 3).forEach(id => {
            const img = document.createElement('img');
            img.src = `img/${id}.png`;
            img.className = 'trainer-img';
            img.onclick = () => { playSound('click'); startGame(); };
            pannel.appendChild(img);
        });
        pokemonsForToday = [...pokemonsPool].sort(() => Math.random() - 0.5).slice(0, 5);
    };

    function startGame() {
        document.getElementById('screen-select').classList.remove('active');
        document.getElementById('screen-adventure').classList.add('active');
        initRound();
    }

    function initRound() {
        energy = 0; updateEnergyUI();
        currentPokemon = pokemonsForToday[attemptCount];
        document.getElementById('attempt-count').innerText = attemptCount;
        document.getElementById('story-display').innerText = "è‰ä¸›é‡Œä¼ æ¥äº†æ²™æ²™å£°...";
        document.getElementById('hp-indicator').innerText = `å¤©å‘ï¼æ˜¯ ${currentPokemon.name}ï¼å¿«è“„åŠ›ï¼`;
        if(decayTimer) clearInterval(decayTimer);
        decayTimer = setInterval(() => { if (energy > 0) energy -= 1.3; updateEnergyUI(); }, 150);
    }

    function addEnergy() {
        playSound('click');
        energy += (16 / currentPokemon.difficulty);
        if (energy >= 100) { energy = 100; clearInterval(decayTimer); setTimeout(showCatchScreen, 300); }
        updateEnergyUI();
    }

    function showCatchScreen() {
        document.getElementById('screen-adventure').classList.remove('active');
        document.getElementById('screen-catch').classList.add('active');
        document.getElementById('wild-pokemon').src = `https://assets.pokemon.com/assets/cms2/img/pokedex/full/${currentPokemon.img}.png`;
        document.getElementById('pokemon-info').innerText = `å‘ç° ${currentPokemon.name}ï¼å¿«æ‰”çƒï¼`;
        const zone = document.getElementById('target-zone');
        zone.style.width = (currentPokemon.acc * 2) + "%";
        zone.style.left = (50 - currentPokemon.acc) + "%";
        tossStep = 0; errors = []; startTossLoop();
    }

    function startTossLoop() {
        cursorPos = 0;
        let speed = 0.8 + Math.random();
        if(tossInterval) clearInterval(tossInterval);
        tossInterval = setInterval(() => {
            cursorPos += speed * cursorDir;
            if (cursorPos >= 100 || cursorPos <= 0) { cursorDir *= -1; speed = 0.8 + Math.random(); }
            document.getElementById('toss-cursor').style.left = cursorPos + "%";
        }, 20);
    }

    function lockToss() {
        playSound('click'); errors.push(Math.abs(cursorPos - 50));
        tossStep++;
        if (tossStep < 3) setTimeout(startTossLoop, 400);
        else finishCatch();
    }

    function finishCatch() {
        clearInterval(tossInterval);
        let avgError = errors.reduce((a, b) => a + b) / 3;
        const slot = document.getElementById(`slot-${attemptCount}`);
        if (avgError <= currentPokemon.acc) {
            playSound('success');
            alert("âœ… å¤ªæ£’äº†ï¼æ”¶æœäº† " + currentPokemon.name);
            slot.innerHTML = `<img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/${currentPokemon.img}.png">`;
            successCount++;
        } else {
            playSound('fail');
            alert("ğŸ’¨ å“å‘€ï¼" + currentPokemon.name + " é€ƒè·‘äº†...");
            slot.innerHTML = "é€ƒè·‘"; slot.classList.add('missed');
        }
        attemptCount++;
        if (attemptCount >= 5) {
            setTimeout(() => {
                document.getElementById('screen-catch').classList.remove('active');
                document.getElementById('screen-win').classList.add('active');
                document.getElementById('final-score').innerText = `ä»Šå¤©æŒ‘æˆ˜äº† 5 åªï¼ŒæˆåŠŸæ”¶æœäº† ${successCount} åªç²¾çµï¼`;
            }, 600);
        } else {
            document.getElementById('screen-catch').classList.remove('active');
            document.getElementById('screen-adventure').classList.add('active');
            initRound();
        }
    }

    function updateEnergyUI() { document.getElementById('energy-fill').style.width = energy + "%"; }
</script>
</body>
</html>
